name: Go
on: 
  push:
    branches:
      - master
jobs:

  build:
    name: Build
    runs-on: ubuntu-latest
    steps:
    - name: Set up Go 1.18 🧧
      uses: actions/setup-go@v3
      with:
        go-version: 1.18
      id: go

    - name: Checkout 🛎️
      uses: actions/checkout@v3

    - name: Build for Linux 🎁
      id: linux
      run: |
        mkdir -p ./build
        version=`cat version` # Version / 版本
        timestamp=`date "+%Y-%m-%d %H:%M:%S"` # Timestamp / 时间戳
        env GOOS=linux GOARCH=amd64    go build -ldflags "-s -w -X main.version=$version -X \"main.timestamp=$timestamp\"" -o ./build/linux/AGDDoS-linux-amd64 ./src/
        echo Built Linux-amd64!
        env GOOS=linux GOARCH=arm64    go build -ldflags "-s -w -X main.version=$version -X \"main.timestamp=$timestamp\"" -o ./build/linux/AGDDoS-linux-arm64 ./src/
        echo Built Linux-arm64!
        env GOOS=linux GOARCH=arm      go build -ldflags "-s -w -X main.version=$version -X \"main.timestamp=$timestamp\"" -o ./build/linux/AGDDoS-linux-arm ./src/
        echo Built Linux-arm!
        env GOOS=linux GOARCH=mips     go build -ldflags "-s -w -X main.version=$version -X \"main.timestamp=$timestamp\"" -o ./build/linux/AGDDoS-linux-mips ./src/
        echo Built Linux-mips!
        env GOOS=linux GOARCH=mipsle   go build -ldflags "-s -w -X main.version=$version -X \"main.timestamp=$timestamp\"" -o ./build/linux/AGDDoS-linux-mipsle ./src/
        echo Built Linux-mipsle!
        env GOOS=linux GOARCH=mips64   go build -ldflags "-s -w -X main.version=$version -X \"main.timestamp=$timestamp\"" -o ./build/linux/AGDDoS-linux-mips64 ./src/
        echo Built Linux-mips64!
        env GOOS=linux GOARCH=mips64le go build -ldflags "-s -w -X main.version=$version -X \"main.timestamp=$timestamp\"" -o ./build/linux/AGDDoS-linux-mips64le ./src/
        echo Built Linux-mips64le!
        
  
    - name: Build for MacOS(Darwin) 🎁
      id: mac
      run: |
        env GOOS=darwin GOARCH=amd64   go build -ldflags "-s -w -X main.version=$version -X \"main.timestamp=$timestamp\"" -o ./build/darwin/AGDDoS-darwin-amd64 ./src/
        echo Built MacOS-amd64!
        env GOOS=darwin GOARCH=arm64   go build -ldflags "-s -w -X main.version=$version -X \"main.timestamp=$timestamp\"" -o ./build/darwin/AGDDoS-darwin-arm64 ./src/
        echo Built MacOS-arm64!
    
    - name: Build for Windows 🎁
      id: win
      run: |
        version=`cat version` # Version / 版本
        timestamp=`date "+%Y-%m-%d %H:%M:%S"` # Timestamp / 时间戳
        env CGO_ENABLED=0 GOOS=windows GOARCH=amd64  go build -ldflags "-s -w -X main.version=$version -X \"main.timestamp=$timestamp\"" -o ./build/windows/AGDDoS-amd64.exe ./src/
        echo Built Windows-amd64!
        env CGO_ENABLED=0 GOOS=windows GOARCH=386  go build -ldflags "-s -w -X main.version=$version -X \"main.timestamp=$timestamp\"" -o ./build/windows/AGDDoS-x86.exe ./src/
        echo Built Windows-x86!
        env CGO_ENABLED=0 GOOS=windows GOARCH=arm64  go build -ldflags "-s -w -X main.version=$version -X \"main.timestamp=$timestamp\"" -o ./build/windows/AGDDoS-arm64.exe ./src/
        echo Built Windows-arm64!
    
    - name: Build for Freebsd 🎁
      id: freebsd
      run: |
        version=`cat version` # Version / 版本
        timestamp=`date "+%Y-%m-%d %H:%M:%S"` # Timestamp / 时间戳
        env GOOS=freebsd GOARCH=amd64  go build -ldflags "-s -w -X main.version=$version -X \"main.timestamp=$timestamp\"" -o ./build/freebsd/AGDDoS-freebsd-amd64 ./src/
        echo Built Freebzd-amd64!
        env GOOS=freebsd GOARCH=386  go build -ldflags "-s -w -X main.version=$version -X \"main.timestamp=$timestamp\"" -o ./build/freebsd/AGDDoS-freebsd-x86 ./src/
        echo Built Freebzd-386!
    
    - name: Upload Linux 📋
      uses: actions/upload-artifact@v3
      with:
        name: AGDDoS-Linux
        path: |
          ./build/linux/*
        retention-days: 14
        if-no-files-found: warn
    
    - name: Upload Freebsd 📋
      uses: actions/upload-artifact@v3
      with:
        name: AGDDoS-Freebsd
        path: |
          ./build/freebsd/*
        retention-days: 7
        if-no-files-found: warn
    
    - name: Upload MacOS 📋
      uses: actions/upload-artifact@v3
      with:
        name: AGDDoS-MacOS
        path: |
          ./build/darwin/*
        retention-days: 7
        if-no-files-found: warn
    
    - name: Upload Windows 📋
      uses: actions/upload-artifact@v3
      with:
        name: AGDDoS-Windows
        path: ./build/windows/*
        retention-days: 14
        if-no-files-found: warn
